(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{481:function(s,t,a){"use strict";a.r(t);var r=a(8),n=Object(r.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[s._v("#")]),s._v(" 准备工作")]),s._v(" "),a("p",[s._v("干了一年多的后端了，这还是第一次有机会在 linux 上通过 nginx 部署项目。\n首先需要的东西就是")]),s._v(" "),a("ul",[a("li",[s._v("服务器（我用的腾讯云，618 买的一年 100）")]),s._v(" "),a("li",[s._v("域名 （有是最好的）")]),s._v(" "),a("li",[s._v("一个前端项目（废话）")])]),s._v(" "),a("h3",{attrs:{id:"前端项目工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端项目工作"}},[s._v("#")]),s._v(" 前端项目工作")]),s._v(" "),a("h4",{attrs:{id:"后端接口配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#后端接口配置"}},[s._v("#")]),s._v(" 后端接口配置")]),s._v(" "),a("p",[s._v("首先接口的代理路径，生产环境需要需要配置成"),a("code",[s._v("你的域名/linux代理地址/...")]),s._v(" 其中"),a("code",[s._v("...")]),s._v("部分就是开发环境配置的路径\n其中"),a("code",[s._v("你的域名")]),s._v("就是你的服务器 ip 或者域名，"),a("code",[s._v("linux代理地址")]),s._v("是下文 Nginx 配置文件中，"),a("code",[s._v("location")]),s._v("中的转发代理名字")]),s._v(" "),a("p",[s._v("因为服务端请求数据使用 node.js 写的，前端需要在根目录写一个"),a("code",[s._v("prod.server.js")]),s._v("文件，\n"),a("img",{attrs:{src:"https://raw.githubusercontent.com/kakigakki/picBed/master/imgs/20201205120952.png",alt:"20201205120952"}}),s._v("\n里面请求的 api 跟"),a("code",[s._v("vue.config.js")]),s._v("中配置的"),a("code",[s._v("devServer")]),s._v("里的 api 是一样的，最后通过"),a("code",[s._v("express")]),s._v("监听需要部署的端口，然后在服务端通过"),a("code",[s._v("pm2")]),s._v("来启动这个文件时，就能监听到"),a("code",[s._v("9123")]),s._v("接口，从而访问到 api 接口。我这项目这边是监听"),a("code",[s._v("9123")])]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("err")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Listening at http://localhost:'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" port "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\n'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("需要注意的因为现在 vue-cli3 默认的路由方式时"),a("code",[s._v("history")]),s._v("（就是 Url 不带#的）,所以当你直接访问项目的非首页时，因为访问不到，会报 404 的错，这时候需要配置一下这个文件，从而让用户访问非首页地址时也能跳转到首页。\n具体配置方法官网也有写，要么就是修改服务端的 Nginx 的配置文件，要么就直接在"),a("code",[s._v("prod.server.js")]),s._v("中添加一个中间件"),a("code",[s._v("connect-history-api-fallback")]),s._v(",然后使用")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" history "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'connect-history-api-fallback'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("h4",{attrs:{id:"路径问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#路径问题"}},[s._v("#")]),s._v(" 路径问题")]),s._v(" "),a("p",[a("code",[s._v("history")]),s._v("模式时，生产环境的路径需要在"),a("code",[s._v("vue.config.js")]),s._v("中配置为绝对路径（别问为什么，问就是踩过的坑，掉过的泪）")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  publicPath"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE_ENV")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'production'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/kakiMuisc'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//kakiMuisc为nginx配置文件中的代理地址")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("h3",{attrs:{id:"linux-端工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#linux-端工作"}},[s._v("#")]),s._v(" linux 端工作")]),s._v(" "),a("h4",{attrs:{id:"环境搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境搭建"}},[s._v("#")]),s._v(" 环境搭建")]),s._v(" "),a("p",[s._v("需要的工具有：")]),s._v(" "),a("ul",[a("li",[s._v("安装 nginx")])]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("\nrpm "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Uvh http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("org"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("packages"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("centos"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("noarch"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RPMS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("release"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("centos"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.")]),s._v("el7"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ngx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("noarch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rpm\nyum install "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y nginx\nsystemctl start nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service\nsystemctl enable nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service\n")])])]),a("ul",[a("li",[s._v("卸载 nginx(有时候需要重装时使用)")])]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s stop\nwhereis nginx\nfind "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name nginx "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//找到所有需要删除的文件")]),s._v("\nrm "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rf 上面找到的文件\nyum remove nginx\n\n")])])]),a("ul",[a("li",[s._v("node.js")])]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("  wget https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nodejs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("org"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dist"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("node"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("linux"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("x64"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xz    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 下载")]),s._v("\n  tar xf  node"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("linux"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("x64"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xz       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 解压")]),s._v("\n  cd node"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("linux"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("x64"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 进入解压目录")]),s._v("\n  ln "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("node安装路径"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("npm   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n  ln "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("node安装路径"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("software"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nodejs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("node   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n  node "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v                               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 执行node命令 查看版本")]),s._v("\n")])])]),a("ul",[a("li",[s._v("pm2")])]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("npm install pm2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("g\npm2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v\n")])])]),a("ul",[a("li",[s._v("git")])]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("yum install git\ngit "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("version\n")])])]),a("h4",{attrs:{id:"拉取项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拉取项目"}},[s._v("#")]),s._v(" 拉取项目")]),s._v(" "),a("p",[s._v("从 github 上拉取需要部署的项目")]),s._v(" "),a("ul",[a("li",[s._v("先配置下全局 git")])]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("git config "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("global user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xxxx"')]),s._v("\ngit config "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("global user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("email "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xxxx"')]),s._v("\n")])])]),a("ul",[a("li",[s._v("拉取")])]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("git clone xxx\n")])])]),a("ul",[a("li",[s._v("安装项目的所有依赖")])]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("npm install\n")])])]),a("ul",[a("li",[s._v("打包")])]),s._v(" "),a("div",{staticClass:"language-JS extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("npm run build\n")])])]),a("h4",{attrs:{id:"使用-pm2-执行-node-应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-pm2-执行-node-应用"}},[s._v("#")]),s._v(" 使用 pm2 执行 node 应用")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("pm2 start prod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//prod.server.js为上文配置的api接口地址")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//0为负载均衡实例，这里不需要，所谓0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//此时访问127.0.0.1:9123 就可以访问到这个项目，但是后端接口是请求不到的，所以需要通过下文配置nginx代理转发")]),s._v("\n")])])]),a("h4",{attrs:{id:"配置-nginx-文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-nginx-文件"}},[s._v("#")]),s._v(" 配置 nginx 文件")]),s._v(" "),a("p",[s._v("找到 nginx 配置文件的所在地址，版本不一样，可能文件不一样\n通过找"),a("code",[s._v("server")]),s._v("字段，可以快速找到需要配置的文件在哪，然后进去配置")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("grep "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rn "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"server"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n")])])]),a("p",[s._v("找到 nginx 配置文件的 server 区域后，配置如下：")]),s._v(" "),a("div",{staticClass:"language-vim extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[s._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    listen       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    server_name  localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    #charset koi8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("r")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    #access_log  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("access"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("log  main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    location "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        root   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("share"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        index  index"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("html index"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    location "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kakiMusic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        proxy_set_header "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("X")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Real"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP $remote_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        proxy_set_header "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("X")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For $proxy_add_x_forwarded_for"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        proxy_set_header Host $http_host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        proxy_set_header "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("X")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("NginX"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Proxy true"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        proxy_pass http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9123")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("需要注意的是下面的部分 location 后面字段的就是上文提到的"),a("code",[s._v("linux代理地址")]),s._v(" "),a("code",[s._v("127.0.0.1:9123")]),s._v("中的端口号就是上文"),a("code",[s._v("prod.server.js")]),s._v("中通过"),a("code",[s._v("express")]),s._v("监听的端口号。\n因为我们已经通过"),a("code",[s._v("pm2")]),s._v("打开了 node 服务，所以其实访问 127.0.0.1:9123 就是访问这个项目，所以通过配置代理地址"),a("code",[s._v("location /kakiMusic/")]),s._v("将端口号转发代理成"),a("code",[s._v("/kakiMusic/")]),s._v("时，访问"),a("code",[s._v("你的域名/kakiMusic")]),s._v("时就相当于访问"),a("code",[s._v("你的域名:9123")]),s._v(" "),a("img",{attrs:{src:"https://raw.githubusercontent.com/kakigakki/picBed/master/imgs/20201205123659.png",alt:"20201205123659"}})]),s._v(" "),a("p",[s._v("配置完成后重启下"),a("code",[s._v("nginx")])]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("nginx "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s reload\n")])])]),a("p",[s._v("然后访问："),a("code",[s._v("你的域名/kakiMusic")]),s._v("就应该可以看到项目了")])])}),[],!1,null,null,null);t.default=n.exports}}]);